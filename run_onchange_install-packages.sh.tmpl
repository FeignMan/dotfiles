{{ if eq .chezmoi.os "linux" -}}
#!/bin/bash

echo -e "\n\e[0;32m  Installing Apt Packages...\e[00m\n"
packageList=""
{{ range .packages.universal.apts -}}
packageList="${packageList} {{ . }}"
{{ end -}}
sudo apt install -yqq $packageList

echo -e "\n\e[0;32m  Installing Snap Packages...\e[00m\n"
{{ range .packages.universal.snap -}}
sudo snap install {{ . }}
{{ end -}}

echo -e "\n\e[0;32m  Installing NVM...\e[00m\n"
latest_nvm_version=$(curl -s https://api.github.com/repos/nvm-sh/nvm/releases/latest | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
echo -e "\n\e[0;32m  Latest NVM version: $latest_nvm_version\e[00m\n"
export NVM_DIR="$HOME/.config/nvm"
curl -o- "https://raw.githubusercontent.com/nvm-sh/nvm/$latest_nvm_version/install.sh" | bash
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm
nvm install --lts

echo -e "\n\e[0;32m  Installing Global NPM Packages...\e[00m\n"
{{ range .packages.universal.npm_packages -}}
npm install -g {{ . }}
{{ end -}}

# Setup Oh-my-zsh and Zsh plugins
echo -e "\n\e[0;32m  Executing setup-zsh.sh...\e[00m\n"
bash ~/.local/share/chezmoi/scripts/setup-zsh.sh

# Setup FZF from releases
echo -e "\n\e[0;32m  Installing FZF...\e[00m\n"
wget -qO "$HOME/fzf.tar.gz" https://github.com/junegunn/fzf/releases/download/v0.63.0/fzf-0.63.0-linux_amd64.tar.gz
mkdir -p $HOME/.local/bin
tar -xf "$HOME/fzf.tar.gz" -C "$HOME/.local/bin/" && rm "$HOME/fzf.tar.gz"

{{ end -}}
